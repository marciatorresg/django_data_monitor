<main class="h-full overflow-y-auto">
  <div class="container px-6 mx-auto grid">
    <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">
      {{ title }}
    </h2>

    <!-- Indicadores -->
    <div class="grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4">

      <!-- Indicador 1 -->
      <div class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-orange-500 bg-orange-100 rounded-full dark:text-orange-100 dark:bg-orange-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13 6a3 3 0 11-6 0..."></path>
          </svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">
             Número total de respuestas
          </p>
          <p id="total-responses" class="text-lg font-semibold text-gray-700 dark:text-gray-200">
            0
          </p>
        </div>
      </div>

      <!-- Indicadores 2-4 -->
      <div class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-green-500 bg-green-100 rounded-full dark:text-green-100 dark:bg-green-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="..."></path></svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">Indicador 2</p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">{{ indicador2 }}</p>
        </div>
      </div>

      <div class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-blue-500 bg-blue-100 rounded-full dark:text-blue-100 dark:bg-blue-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="..."></path></svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">Indicador 3</p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">{{ indicador3 }}</p>
        </div>
      </div>

      <div class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-teal-500 bg-teal-100 rounded-full dark:text-teal-100 dark:bg-teal-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="..."></path></svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">Indicador 4</p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">{{ indicador4 }}</p>
        </div>
      </div>

    </div>

    <div class="grid gap-6 mb-8 md:grid-cols-2">

      <!-- BEGIN - Datos -->
      <div class="row-span-1 w-full overflow-hidden rounded-lg shadow-xs mb-6">
<!-- Tabla -->
<div class="w-full overflow-x-auto">
  <table class="w-full whitespace-no-wrap">
    <thead>
      <tr
        class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
        <th class="px-4 py-3">Nombre</th>
        <th class="px-4 py-3">Motivo</th>
        <th class="px-4 py-3">Mensaje</th>
        <th class="px-4 py-3">Fecha</th>
      </tr>
    </thead>
    <tbody id="data-table-body" class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
      <!-- Aquí se insertarán los datos dinámicamente -->
    </tbody>
  </table>
</div>

<!-- Contador -->
<div class="mt-4 flex items-center space-x-2">
  <span id="table-total-responses" class="text-lg font-bold">0</span>
  <span id="total-label" class="text-gray-500">0 respuestas</span>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const tbody = document.getElementById("data-table-body");
  const totalResponsesEl = document.getElementById("table-total-responses");
  const totalLabelEl = document.getElementById("total-label");
  const apiUrl = "http://mtorresg.pythonanywhere.com/landing/api/index/?format=json";

  async function cargarDatos() {
    try {
      const response = await fetch(apiUrl);
      if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
      const data = await response.json();

      tbody.innerHTML = "";
      const keys = Object.keys(data);

      if (keys.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="text-center py-4">No hay datos disponibles</td></tr>`;
        totalResponsesEl.textContent = "0";
        totalLabelEl.textContent = "0 respuestas";
        return;
      }

      keys.sort((a, b) => {
        const dateA = new Date(data[a].timestamp || data[a].fecha || 0);
        const dateB = new Date(data[b].timestamp || data[b].fecha || 0);
        return dateB - dateA;
      });

      keys.forEach(key => {
        const item = data[key];
        tbody.innerHTML += `
          <tr class="text-gray-700 dark:text-gray-400">
            <td class="px-4 py-3 text-sm">${item.nombre || ""}</td>
            <td class="px-4 py-3 text-sm">${item.motivo || ""}</td>
            <td class="px-4 py-3 text-sm">${item.mensaje || ""}</td>
            <td class="px-4 py-3 text-sm">${item.timestamp || item.fecha || ""}</td>
          </tr>
        `;
      });

      totalResponsesEl.textContent = keys.length;
      totalLabelEl.textContent = `${keys.length} respuestas`;

    } catch (error) {
      tbody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">Error al cargar datos: ${error.message}</td></tr>`;
      totalResponsesEl.textContent = "0";
      totalLabelEl.textContent = "0 respuestas";
    }
  }

  cargarDatos();
  setInterval(cargarDatos, 10000);
});
</script>
